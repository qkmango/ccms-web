<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="utf-8">
    <title>账户信息</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="/lib/layui/css/layui.css" media="all">
    <link rel="stylesheet" href="/css/public.css" media="all">
    <link rel="stylesheet" href="/lib/font-awesome-4.7.0/css/font-awesome.min.css" media="all">
    <style>
        .layui-card {
            padding-bottom: 10px;
        }
    </style>
</head>
<body>
<div class="layuimini-container">
    <div class="layuimini-main">

        <div class="layui-bg-gray" style="padding: 30px;">
            <div class="layui-row layui-col-space15">
                <div class="layui-col-md6 layui-col-sm12 layui-col-xs12">
                    <div class="layui-card layui-row">
                        <div class="layui-card-header layui-bg-sf-green-dark">基本信息</div>
                        <div class="layui-card-body" id="account_info">
                            <i class="layui-icon layui-icon-loading layui-anim layui-anim-rotate layui-anim-loop"></i>
                            加载中
                        </div>
                    </div>
                </div>
                <div class="layui-col-md6 layui-col-sm12 layui-col-xs12" id="department_info_box">
                    <div class="layui-card layui-row">
                        <div class="layui-card-header layui-bg-sf-green-dark">教学单位信息</div>
                        <div class="layui-card-body" id="department_info">
                            <i class="layui-icon layui-icon-loading layui-anim layui-anim-rotate layui-anim-loop"></i>
                            加载中
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>
<script src="/lib/layui/layui.js" charset="utf-8"></script>
<script src="/js/lay-config.js" charset="utf-8"></script>
<script src="/lib/util/layui_verify_config.js"></script>
<script src="/lib/util/common.js"></script>
<script>

    let form, $;

    layui.use(['form'], function () {
        form = layui.form;
        $ = layui.jquery;


        $.ajax({
            url: common.url("account/one/current-account-info.do"),
            // url: "./index.test.json",
            dataType: "json",
            type:'get',
            xhrFields: {
                withCredentials: true,
            },
            success: function (res) {
                if (res.success) {
                    const data = res.data;

                    if (data.account.role === 'user') {
                        document.querySelector('#account_info').innerHTML = `
                        <div class="layui-col-md4 layui-col-sm4 layui-col-xs12">
                            账户 : ${data.account.id}<br>
                            姓名 : ${data.user.name}
                        </div>
                        <div class="layui-col-md4 layui-col-sm4 layui-col-xs12">
                            卡状态 : ${
                                data.card.state==='normal'?`<span class="layui-badge-rim layui-bg-green2-tint">正常</span>`:
                                data.card.state==='loss'?`<span class="layui-badge-rim layui-bg-red-tint">挂失</span>`:
                                data.card.state==='canceled'?`<span class="layui-badge-rim layui-bg-red-tint">注销</span>`:''
                            }
                            <br>
                            卡余额 : ${data.card.balance / 100} 元
                        </div>
                        <div class="layui-col-md4 layui-col-sm4 layui-col-xs12">
                            账户状态 : ${
                            data.account.state==='normal'?`<span class="layui-badge-rim layui-bg-green2-tint">正常</span>`:
                            data.account.state==='frozen'?`<span class="layui-badge-rim layui-bg-orange-tint">冻结</span>`:
                            data.account.state==='canceled'?`<span class="layui-badge-rim layui-bg-red-tint">注销</span>`:''
                        }<br>
                            账户类型 : 用户
                        </div>
                        <div class="layui-col-md4 layui-col-sm4 layui-col-xs12">
                        邮箱 : ${data.user.email || ''}
                        </div>`
                        

                        let department_info = '';
                        data.departmentChain.forEach(item => {
                            department_info += 
                            `<div class="layui-col-md6 layui-col-sm4 layui-col-xs12">
                                ${
                                    item.type==='faculty'?'学院':
                                    item.type==='major'?'专业':
                                    item.type==='clazz'?'班级':''
                                } : ${item.name}
                            </div>`;
                        });
                        document.querySelector('#department_info').innerHTML = department_info;
                        return;
                    }

                    if (data.account.role === 'admin') {
                        document.querySelector('#account_info').innerHTML = `
                        <div class="layui-col-md4 layui-col-sm4 layui-col-xs12">
                            账号 : ${data.account.id}<br>
                            姓名 : ${data.account.name}
                        </div>

                        <div class="layui-col-md4 layui-col-sm4 layui-col-xs12">账户类型 : 管理员</div>
                        <div class="layui-col-md4 layui-col-sm4 layui-col-xs12">
                        邮箱 : ${data.account.email || ''}
                        </div>
                    `
                        document.querySelector('#department_info_box').style.display = 'none'
                        return;
                    }

                }
                layer.msg(res.message, {icon: 2});
            },
            error: function (jqXHR, textStatus, errorThrown) {
                layer.msg(jqXHR.status + '', {icon: 2});
            }
        })


    });
</script>
</body>
</html>
